:; exec emacs -Q --script "$0" -- "$@" # -*- mode: emacs-lisp; lexical-binding: t -*-

(setq
 debug-on-error t						; show stack stace
 argv (cdr argv))						; remove '--' from CL arguments

(push (concat (file-name-directory load-file-name) "/..") load-path)
(require 'json)
(require 'ph-u)

;; monkey patch
(defun define-package (name version &optional docstring reqs)
  (list name version docstring reqs))



(unless (and (car argv) (file-readable-p (car argv)))
  (message "Usage: %s some-pkg.el" (file-name-base load-file-name))
  (kill-emacs 1))

(condition-case err
	(setq pkgdata (eval (read (ph-read-file (car argv)))))
  (error
   (message "eval error: %s" (error-message-string err))
   (kill-emacs 1)))

(setq r (json-new-object))
(setq r (json-add-to-object r "name" (nth 0 pkgdata)))
(setq r (json-add-to-object r "version" (nth 1 pkgdata)))
(setq r (json-add-to-object r "docstring" (nth 2 pkgdata)))
(setq r (json-add-to-object r "reqs" (nth 3 pkgdata)))

(princ (json-encode r))
